# Helm chart for SHOGun-Boot

Helm chart that uses the `docker-public.terrestris.de/shogun/shogun-boot` docker image for Kubernetes cluster deployments. The shogun-boot version can be defined in the `Chart.yaml` file by setting `appVersion`.

## Parameter overview

The following table gives an overview about the application specific parameters that might be adjusted in (a custom) `values.yaml` for a given environment:

| Key | Description                                                                                                                                                                                                                                                          | Default                                                                                                                                                     |
|-----|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `postgres.host` | The (internal) host of the (PostgreSQL) database server the application will store all its content in.                                                                                                                                                               | `shogun-postgis`                                                                                                                                            |
| `postgres.port` | The port of the (internal) database server. Typically this parameter doesn't need to be changed as it's the default of a PostgreSQL database.                                                                                                                        | `5432`                                                                                                                                                      |
| `postgres.databasename` | The name of the database. Typically this parameter doesn't need to be changed.                                                                                                                                                                                       | `shogun`                                                                                                                                                    |
| `postgres.schema` | The schema name inside `postgres.databasename` database. Typically this parameter shouldn't be changed as some internal configurations depend on it.                                                                                                                         | `shogun`                                                                                                                                                    |
| `keycloak.host` | The (external) host of the Keycloak server.                                                                                                                                                                                                                          | `keycloak.example.com`                                                                                                                                      |
| `keycloak.realm` | The Keycloak realm the application should check all authorizations against. This realm needs to contain the given `keycloak.clientId`, all users and their respective role associations.                                                                             | `shogun`                                                                                                                                                    |
| `keycloak.clientId` | The ID of the client inside the given realm. The client is usually specific for this application and holds the required roles (currently `admin`, `user`, `viewer`). Since no user login is done via the backend the client is usually of access-type `bearer-only`. | `shogun-boot`                                                                                                                                               |
| `keycloak.masterRealm` | The name of the realm that holds the realm management Keycloak user (see secret `KEYCLOAK_USER`). Typically the same as `keycloak.realm`.                                                                                                                            | `shogun`                                                                                                                                                    |
| `keycloak.adminClientId` | The ID of the admin client for the access to the REST-API of Keycloak. In a typical Keycloak installation this doesn't need to be changed.                                                                                                                           | `admin-cli`                                                                                                                                                 |
| `shogun.additionalJavaArgs` | The Java runtime parameters for SHOGun application. Adjust the memory settings as needed, but ususally the defaults are quite sufficient.                                                                                                                            | `-Xms512m -Xmx512m -Djdk.serialSetFilterAfterRead=true -Dspring.config.location=/config/application.yml -Dlog4j2.configurationFile=file:/config/log4j2.yml` |
| `envers.enabled` | If envers versioning is enabled.                                                                                                                                                                                                                                     | `false`                                                                                                                                                     |
| `mail.enabled` | If sending mails is enabled, this requires the appropriate secrets to be set.                                                                                                                                                                                        | `false`                                                                                                                                                     |
| `mail.host` | The host name of the smtp mail server.                                                                                                                                                                                                                               | `shogun-mail`                                                                                                                                               |
| `mail.port` | The port of the smtp mail server.                                                                                                                                                                                                                                    | `587`                                                                                                                                                       |
| `controller.applications` | If the `applications` controller is enabled.                                                                                                                                                                                                                         | `true`                                                                                                                                                      |
| `controller.auth` | If the `auth` controller is enabled.                                                                                                                                                                                                                                 | `true`                                                                                                                                                      |
| `controller.cache` | If the `cache` controller is enabled.                                                                                                                                                                                                                                | `true`                                                                                                                                                      |
| `controller.files` | If the `files` controller is enabled.                                                                                                                                                                                                                                | `true`                                                                                                                                                      |
| `controller.groups` | If the `groups` controller is enabled.                                                                                                                                                                                                                               | `true`                                                                                                                                                      |
| `controller.imagefiles` | If the `imagefiles` controller is enabled.                                                                                                                                                                                                                           | `true`                                                                                                                                                      |
| `controller.info` | If the `info` controller is enabled.                                                                                                                                                                                                                                 | `true`                                                                                                                                                      |
| `controller.layers` | If the `layers` controller is enabled.                                                                                                                                                                                                                               | `true`                                                                                                                                                      |
| `controller.users` | If the `users` controller is enabled.                                                                                                                                                                                                                                | `true`                                                                                                                                                      |
| `controller.resource` | If the `resource` controller is enabled.                                                                                                                                                                                                                             | `true`                                                                                                                                                      |
| `support.email` | The support email address.                                                                                                                                                                                                                                           | `support@example.com`                                                                                                                                       |
| `debug.sql` | Show SQL statements in the log files.                                                                                                                                                                                                                                | `false`                                                                                                                                                     |
| `debug.cache` | Show cache statistics in the log files.                                                                                                                                                                                                                              | `false`                                                                                                                                                     |
| `debug.graphiql` | Enable graphiql.                                                                                                                                                                                                                                                     | `false`                                                                                                                                                     |


## Secrets overview

This table lists all required secrets for the chart. Please note that currently they are expected to be stored in the given secret name/key combination.

| Internal environment variable name | Description                                                                                                                                                                                                                                                                                             | Secret name | Secret key |
|------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|------------|
| `DB_USER` | The database user (see `postgres.host`).                                                                                                                                                                                                                                                                | `postgres-credentials` | `username` |
| `DB_PASSWORD` | The password for the database user.                                                                                                                                                                                                                                                                     | `postgres-credentials` | `password` |
| `KEYCLOAK_USER` | The name of a Keycloak user (inside the `keycloak.masterRealm`) that has granted some asorted realm management roles (currently `query_users` and `view_users` are required). This user is  needed for getting some user details like the username on-the-fly and doesn't require any write priviliges. | `keycloak-credentials` | `username` |
| `KEYCLOAK_PASSWORD` | The password of the Keycloak user.                                                                                                                                                                                                                                                                      | `keycloak-credentials` | `password` |
| `MAIL_USER` | The name of the mail user (only needed if `mail.enabled`).                                                                                                                                                                                                                                              | `mail-credentials` | `username` |
| `MAIL_PASSWORD` | The password of the mail user (only needed if `mail.enabled`).                                                                                                                                                                                                                                                                         | `mail-credentials` | `password` |
